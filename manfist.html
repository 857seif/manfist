<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steam AppID & Manifest Generator - Seif Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0d1b2a;
            --secondary: #1b263b;
            --accent: #415a77;
            --text: #e0e1dd;
            --background: #0a0f1c;
            --card-bg: #1a2332;
            --success: #4cc9f0;
            --warning: #f72585;
            --error: #e63946;
            --terminal-bg: #0d1322;
            --source1-bg: #4cc9f0;
            --source2-bg: #f0964c;
            --source3-bg: #7209b7;
            --online-fix-bg: #108a00;
            --custom-link-bg: #9d4edd;
            --glow-color: rgba(76, 201, 240, 0.5);
            /* ألوان إضافية لبيانات API */
            --api-bg: #2a475e;
            --api-text: #c7d5e0;
            --api-highlight: #66c0f4;
            --api-price: #5ba32b;
        }

        /* أنماط الكود الأول الأساسية */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body {
            background-image: url('https://generacionxbox.com/wp-content/uploads/2024/03/steam-juegos-gratis-1200x675.jpeg');
            background-size: cover; background-attachment: fixed; background-position: center center;
            background-color: rgba(0, 0, 0, 0.7); background-blend-mode: darken; color: var(--text);
            min-height: 100vh; padding: 20px; position: relative; overflow-x: hidden;
        }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(76, 201, 240, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(247, 37, 133, 0.1) 0%, transparent 50%);
            pointer-events: none; z-index: -1;
        }
        .container {
            max-width: 950px; margin: 0 auto; background-color: rgba(0, 0, 0, 0.4);
            padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.05); position: relative; overflow: hidden;
        }
        .container::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 3px;
            background: linear-gradient(90deg, var(--success), var(--accent), var(--warning)); z-index: 1;
        }
        header { text-align: center; padding: 30px 0; margin-bottom: 20px; position: relative; }
        .logo { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 10px; }
        .logo i { font-size: 2.8rem; color: var(--accent); filter: drop-shadow(0 0 10px var(--glow-color)); animation: pulse 3s infinite alternate; }
        .logo h1 { font-size: 2.2rem; font-weight: 700; color: var(--text); text-shadow: 0 0 10px rgba(255, 255, 255, 0.2); }
        .seif-credit { font-size: 1.2rem; font-weight: 700; margin-top: 10px; margin-bottom: 15px; animation: rainbow 6s ease-in-out infinite; display: block; position: relative; padding: 5px 10px; border-radius: 5px; background: rgba(0, 0, 0, 0.2); }
        header p { font-size: 1.1rem; color: var(--accent); max-width: 600px; margin: 0 auto; text-shadow: 0 0 5px rgba(0, 0, 0, 0.5); }
        .search-section, .results-section {
            background: var(--card-bg); border-radius: 12px; padding: 25px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
            margin-bottom: 30px; border: 1px solid rgba(255, 255, 255, 0.05); position: relative; overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .section-title {
            text-align: center; margin-bottom: 25px; font-size: 1.5rem; color: var(--accent);
            display: flex; align-items: center; justify-content: center; gap: 10px; position: relative;
        }
        .section-title::after {
            content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%);
            width: 50px; height: 2px; background: linear-gradient(90deg, transparent, var(--accent), transparent);
        }
        .input-group { margin-bottom: 25px; position: relative; }
        .input-group label { display: block; margin-bottom: 10px; font-weight: 600; font-size: 1.1rem; color: var(--text); }
        .input-group input {
            width: 100%; padding: 15px; border: 2px solid var(--secondary); background: rgba(255, 255, 255, 0.05);
            border-radius: 8px; color: white; font-size: 1.1rem; transition: all 0.3s;
        }
        .input-group input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(65, 90, 119, 0.3); background: rgba(255, 255, 255, 0.08); }
        .input-group .example { margin-top: 8px; font-size: 0.9rem; color: var(--accent); }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .btn {
            background: linear-gradient(135deg, var(--accent), var(--secondary)); color: white; border: none;
            padding: 15px 15px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;
            display: block; width: 100%; font-size: 1rem; margin-bottom: 0; flex-grow: 1; min-width: 180px;
            position: relative; overflow: hidden;
        }
        .btn:hover { background: linear-gradient(135deg, #4a6fa1, var(--accent)); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
        .info-box { background: rgba(255, 255, 255, 0.03); border-radius: 8px; padding: 20px; margin-top: 25px; border-left: 4px solid var(--accent); position: relative; }
        .info-box a { color: var(--accent); text-decoration: none; font-weight: 600; transition: color 0.3s; }
        .terminal {
            background: var(--terminal-bg); border-radius: 8px; padding: 20px; height: 150px; 
            overflow-y: auto; font-family: monospace; font-size: 1.1rem; margin-bottom: 20px; border: 1px solid rgba(255, 255, 255, 0.1); position: relative;
        }
        .terminal-line { margin-bottom: 10px; line-height: 1.5; position: relative; z-index: 1; }
        .terminal-cmd { color: var(--success); }
        .terminal-msg { color: var(--text); }
        .terminal-error { color: var(--error); }
        .online-fix-btn { background: linear-gradient(135deg, var(--online-fix-bg), #0f6e00); min-width: 200px !important; }
        .custom-link-btn { background: linear-gradient(135deg, var(--custom-link-bg), #7b2cbf); min-width: 200px !important; }
        .download-btn-1 { background: linear-gradient(135deg, var(--source1-bg), #2a9d8f); }
        .download-btn-2 { background: linear-gradient(135deg, var(--source2-bg), #d35400); }
        .download-btn-3 { background: linear-gradient(135deg, var(--source3-bg), #480ca8); }
        .loading {
            display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite;
        }
        #gameImageContainer {
            text-align: center; margin-bottom: 20px; display: none; animation: fadeIn 0.5s ease-in-out;
            flex-direction: column; align-items: center;
        }
        #gameImage {
            width: 100%; max-width: 460px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1); transition: transform 0.3s, box-shadow 0.3s;
        }
        .history-item {
            background: var(--secondary); padding: 12px 15px; margin-bottom: 8px; border-radius: 6px;
            font-size: 1rem; color: var(--text); cursor: pointer; transition: background 0.2s, transform 0.2s, box-shadow 0.2s;
            display: flex; justify-content: space-between; align-items: center; position: relative; overflow: hidden;
        }
        .history-item:hover { background: var(--accent); transform: translateX(5px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); }
        #historyList { list-style: none; padding: 0; }
        #toastContainer { position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
        .toast {
            background-color: var(--card-bg); color: var(--text); padding: 15px 20px; border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4); max-width: 300px; min-width: 250px; border-right: 4px solid var(--success);
            opacity: 0; transform: translateX(100%); animation: slideIn 0.3s forwards, slideOut 0.3s 3.7s forwards;
            display: flex; align-items: center; gap: 10px; position: relative; overflow: hidden;
        }
        .toast.error-toast { border-right-color: var(--error); }
        .toast.info-toast { border-right-color: var(--accent); }
        
        /* أنماط API المدمجة */
        #apiGameInfo {
            background-color: var(--api-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            display: none; 
        }

        .api-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--secondary);
            padding-bottom: 15px;
        }

        .api-title {
            color: var(--text);
            font-size: 24px;
            margin-right: 15px;
        }
        .api-app-id {
            background-color: var(--secondary);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            margin-top: 5px;
        }
        .api-details {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .api-detail-item {
            background-color: var(--card-bg);
            padding: 10px;
            border-radius: 5px;
        }
        .api-detail-label {
            color: var(--api-highlight);
            font-size: 14px;
            margin-bottom: 5px;
        }
        .api-price {
            color: var(--api-price);
            font-weight: bold;
            font-size: 18px;
        }
        .api-description {
            margin-top: 15px;
            font-size: 1rem;
            line-height: 1.6;
        }

        /* تحسين زر الوصف ليصبح زر عرض معلومات Steam */
        #steamInfoBtn {
            background: linear-gradient(135deg, var(--api-highlight), var(--accent));
        }

    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    
    <div class="container">
        <header>
            <div class="logo">
                <i class="fab fa-steam"></i>
                <h1>Steam AppID & Manifest Generator</h1>
            </div>
            
            <p class="seif-credit">By ☄Ṡ̸̚̕͝EI̵͎͎̝͐F̴̅ افندي✨</p>
            
            <p></p>
        </header>
        
        <div class="search-section">
            <div class="section-title">
                <i class="fas fa-search"></i>
                <h2>ابحث عن ملفات اللعبة</h2>
            </div>

            <div class="input-group">
                <label for="appId">أدخل AppID أو اسم اللعبة:</label>
                <input type="text" id="appId" placeholder="مثال: 271590 أو Cyberpunk 2077" autocomplete="off">
                <div class="example">أدخل رقم الـ AppID أو اسم اللعبة وسنقوم بالبحث عنه.</div>
            </div>
            
            <button class="btn" id="generateBtn">
                <i class="fas fa-bolt"></i> توليد روابط التحميل والبحث عن المعلومات
            </button>
            
            <div id="onlineFixInputGroup" style="display: none; margin-top: 25px; padding-top: 15px; border-top: 1px dashed var(--secondary);">
                <button class="btn steamdb-name-btn" id="steamDBNameBtn">
                    <i class="fas fa-copy"></i> استخدم الاسم المُكتشف تلقائيًا أو انسخ من SteamDB
                </button>
                <div class="input-group" style="margin-top: 15px;">
                    <label for="gameName">اسم اللعبة للبحث في Online Fix (تعبئة تلقائية):</label>
                    <input type="text" id="gameName" placeholder="مثال: Grand Theft Auto V" autocomplete="off">
                    <div class="example">سيتم استخدام الاسم للبحث في موقع Online Fix.</div>
                </div>
                <button class="btn fix-search-btn" id="fixSearchBtn">
                    <i class="fas fa-search"></i> بحث في Online Fix
                </button>
            </div>

            <div class="info-box">
                <p>يمكنك العثور على AppID لأي لعبة من خلال زيارة <a href="https://steamdb.info" target="_blank">SteamDB</a> والبحث عن اللعبة.</p>
                <p></p>
                <p style="color:var(--api-highlight); margin-top:10px;"></p>
            </div>
        </div>
        
        <div class="search-section" style="margin-bottom: 30px;">
            <div class="section-title">
                <i class="fas fa-history"></i>
                <h2>سجل البحث (آخر 10)</h2>
            </div>
            <ul id="historyList">
                <p style="color:var(--accent); text-align:center; padding:10px;">لا يوجد سجل بحث حالياً.</p>
            </ul>
        </div>

        <div class="results-section">
            <div class="section-title">
                <i class="fas fa-terminal"></i>
                <h2>نتيجة البحث ومعلومات اللعبة</h2>
            </div>

            <div id="gameImageContainer" style="display: none; flex-direction: column; align-items: center;">
                <img id="gameImage" src="" alt="صورة غلاف اللعبة">
                <button class="btn info-btn" id="steamInfoBtn" style="display: none;">
                    <i class="fas fa-info-circle"></i> عرض معلومات Steam API
                </button>
            </div>

            <div id="apiGameInfo">
            </div>
            
            <div class="terminal" id="terminal">
                <div class="terminal-line">> System initialized. Ready to process requests.</div>
                <div class="terminal-line">> Enter a valid Steam AppID or search by name.</div>
            </div>

            <div class="success-checkmark" id="successCheckmark">
                <div class="check-icon"></div>
                <p></p>
            </div>
            
            <div class="btn-group" id="downloadButtonsGroup" style="display: none;">
                <button class="btn download-btn online-fix-btn" id="onlineFixBtn">
                    <i class="fas fa-globe"></i> Online Fix
                </button>
                <button class="btn download-btn custom-link-btn" id="customLinkBtn" style="display: none;">
                    <i class="fas fa-link"></i> رابط مخصص <span class="custom-link-indicator">!</span>
                </button>
                <button class="btn download-btn download-btn-1" id="downloadBtn1">
                    <i class="fas fa-file-download"></i> تحميل (المصدر 1)
                </button>
                <button class="btn download-btn download-btn-2" id="downloadBtn2">
                    <i class="fas fa-code-branch"></i> تحميل (المصدر 2)
                </button>
                <button class="btn download-btn download-btn-3" id="downloadBtn3">
                    <i class="fas fa-cloud-download-alt"></i> تحميل (المصدر 3)
                </button>
            </div>
        </div>
        
        <footer>
            <p></p>
            <p></p>
        </footer>
    </div>
    
    <div id="toastContainer"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            
            const generateBtn = document.getElementById('generateBtn');
            const appIdInput = document.getElementById('appId');
            
            const onlineFixInputGroup = document.getElementById('onlineFixInputGroup');
            const steamDBNameBtn = document.getElementById('steamDBNameBtn');
            const gameNameInput = document.getElementById('gameName'); 
            const fixSearchBtn = document.getElementById('fixSearchBtn');
            
            const terminal = document.getElementById('terminal');
            const successCheckmark = document.getElementById('successCheckmark');
            const gameImageContainer = document.getElementById('gameImageContainer');
            const gameImage = document.getElementById('gameImage');
            
            const steamInfoBtn = document.getElementById('steamInfoBtn'); 
            const apiGameInfo = document.getElementById('apiGameInfo'); 

            const downloadButtonsGroup = document.getElementById('downloadButtonsGroup');
            const downloadBtn1 = document.getElementById('downloadBtn1');
            const downloadBtn2 = document.getElementById('downloadBtn2');
            const downloadBtn3 = document.getElementById('downloadBtn3');
            const onlineFixBtn = document.getElementById('onlineFixBtn');
            const customLinkBtn = document.getElementById('customLinkBtn');
            
            const historyList = document.getElementById('historyList');
            
            let customLinksData = {};
            let currentAppId = '';
            let currentApiData = null; 

            function createParticles() {
                const particlesContainer = document.getElementById('particles');
                const particleCount = 30;
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                }
            }

            async function loadCustomLinks() {
                try {
                    const response = await fetch('https://raw.githubusercontent.com/your-username/your-repo/main/custom-links.json');
                    if (!response.ok) {
                        throw new Error('لم يتم العثور على ملف الروابط المخصصة');
                    }
                    customLinksData = await response.json();
                } catch (error) {
                    customLinksData = {
                        "1030300": "https://drive.usercontent.google.com/download?id=1WIjPYBKruObyMHLf3aaMbJKRv_fFByTB&export=download",
                        "2807960": "https://drive.usercontent.google.com/u/0/uc?id=16GS4ONXQ2Hx-PYXcLyYKRFV8Px4xEvT4&export=download",
                    };
                }
            }
            
            loadCustomLinks();

            function typeWriter(text, className, delay = 0) {
                return new Promise(resolve => {
                    setTimeout(() => {
                        const line = document.createElement('div');
                        line.classList.add('terminal-line', className);
                        terminal.appendChild(line);
                        
                        let i = 0;
                        const interval = setInterval(() => {
                            if (i < text.length) {
                                line.innerHTML += text.charAt(i);
                                i++;
                                terminal.scrollTop = terminal.scrollHeight;
                            } else {
                                clearInterval(interval);
                                resolve();
                            }
                        }, 20);
                    }, delay);
                });
            }
            
            function showToast(message, type = 'success', duration = 4000) {
                const container = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.classList.add('toast', `${type}-toast`);
                
                let icon = '';
                if (type === 'success') { icon = '<i class="fas fa-check-circle" style="color:var(--success);"></i>'; }
                else if (type === 'error') { icon = '<i class="fas fa-times-circle" style="color:var(--error);"></i>'; }
                else if (type === 'info') { icon = '<i class="fas fa-info-circle" style="color:var(--accent);"></i>'; }

                toast.innerHTML = `${icon} <span>${message}</span>`;
                container.appendChild(toast);

                setTimeout(() => {
                    toast.style.animation = 'slideOut 0.3s forwards';
                    setTimeout(() => { container.removeChild(toast); }, 300);
                }, duration);
            }

            const STORAGE_KEY = 'last10AppIDs';

            function loadAppIDs() {
                const data = localStorage.getItem(STORAGE_KEY);
                return data ? JSON.parse(data) : [];
            }

            function saveAppID(appId, gameName) {
                let appIDs = loadAppIDs();
                const newItem = { appId, gameName: gameName || 'غير محدد' };
                
                appIDs = appIDs.filter(item => item.appId !== appId);
                appIDs.unshift(newItem);
                appIDs = appIDs.slice(0, 10);
                
                localStorage.setItem(STORAGE_KEY, JSON.stringify(appIDs));
                displayHistory();
            }

            function displayHistory() {
                if (!historyList) return; 
                
                const appIDs = loadAppIDs();
                historyList.innerHTML = ''; 
                
                if (appIDs.length === 0) {
                    historyList.innerHTML = '<p style="color:var(--accent); text-align:center; padding:10px;">لا يوجد سجل بحث حالياً.</p>';
                    return;
                }

                appIDs.forEach(item => {
                    const li = document.createElement('li');
                    
                    const customIndicator = customLinksData[item.appId] ? 
                        '<span class="custom-link-indicator" style="margin-right: 8px;">مخصص</span>' : '';
                    
                    li.innerHTML = `${customIndicator} AppID: ${item.appId} | اللعبة: ${item.gameName}`;
                    li.classList.add('history-item');
                    li.title = 'انقر للبحث مرة أخرى';
                    
                    li.addEventListener('click', () => {
                        appIdInput.value = item.appId;     
                        gameNameInput.value = item.gameName === 'غير محدد' ? '' : item.gameName; 
                        generateManifest(true);                 
                    });
                    
                    historyList.appendChild(li);
                });
            }
            
            async function fetchGameData(appId) {
                const proxyUrls = [
                    'https://cors-anywhere.herokuapp.com/',
                    'https://corsproxy.io/?',
                    'https://api.allorigins.win/raw?url=',
                ];
                
                const apiUrl = `https://store.steampowered.com/api/appdetails?appids=${appId}&cc=us&l=arabic`; 
                
                for (let proxy of proxyUrls) {
                    try {
                        let fetchUrl = '';
                        if (proxy.includes('allorigins')) {
                            fetchUrl = proxy + encodeURIComponent(apiUrl);
                        } else {
                            fetchUrl = proxy + apiUrl;
                        }
                        
                        const response = await fetch(fetchUrl);
                        
                        if (response.ok) {
                            const data = await response.json();
                            
                            if (data[appId] && data[appId].success) {
                                return data[appId].data;
                            } 
                        }
                    } catch (error) {
                        console.warn(`Proxy failed: ${proxy}`, error);
                    }
                }
                
                throw new Error('API_FETCH_FAILED_ALL_PROXIES');
            }

            function displayApiInfo(game) {
                currentApiData = game;
                apiGameInfo.style.display = 'block';

                const priceInfo = game.is_free ? "مجانية" : (game.price_overview ? game.price_overview.final_formatted : "غير متوفر");
                const releaseDate = game.release_date ? game.release_date.date : "غير معروف";
                const developers = game.developers ? game.developers.join(', ') : "غير معروف";
                const publishers = game.publishers ? game.publishers.join(', ') : "غير معروف";
                const description = game.short_description || "لا يوجد وصف متوفر";
                
                apiGameInfo.innerHTML = `
                    <div class="api-header">
                        <h2 class="api-title">${game.name}</h2>
                        <div class="api-app-id">App ID: ${currentAppId}</div>
                    </div>
                    
                    <div class="api-details">
                        <div class="api-detail-item">
                            <div class="api-detail-label">السعر</div>
                            <div class="api-price">${priceInfo}</div>
                        </div>
                        <div class="api-detail-item">
                            <div class="api-detail-label">تاريخ الإصدار</div>
                            <div>${releaseDate}</div>
                        </div>
                        <div class="api-detail-item">
                            <div class="api-detail-label">المطورون</div>
                            <div>${developers}</div>
                        </div>
                        <div class="api-detail-item">
                            <div class="api-detail-label">الناشرون</div>
                            <div>${publishers}</div>
                        </div>
                    </div>
                    
                    <div class="api-description">
                        <p>${description}</p>
                    </div>
                `;

                gameNameInput.value = game.name;
            }

            steamInfoBtn.addEventListener('click', () => {
                apiGameInfo.style.display = apiGameInfo.style.display === 'block' ? 'none' : 'block';
                steamInfoBtn.innerHTML = apiGameInfo.style.display === 'block' ? '<i class="fas fa-times-circle"></i> إخفاء معلومات Steam' : '<i class="fas fa-info-circle"></i> عرض معلومات Steam API';
            });
            
            async function processInputAsName(gameName) {
                if (!gameName) {
                    return; 
                }

                generateBtn.innerHTML = '<span class="loading"></span> جاري البحث عن AppID...';
                generateBtn.disabled = true;

                await typeWriter(`> Detected name: "${gameName}". Searching for AppID...`, 'terminal-cmd', 300);

                const searchApiUrl = `https://store.steampowered.com/api/storesearch/?cc=us&l=arabic&term=${encodeURIComponent(gameName)}&category1=998&page=1&pageSize=1`;
                const proxyUrls = [
                    'https://cors-anywhere.herokuapp.com/',
                    'https://corsproxy.io/?',
                    'https://api.allorigins.win/raw?url=', 
                ];
                
                try {
                    let data = null;
                    for(let proxy of proxyUrls) {
                        try {
                            let fetchUrl = '';
                            if (proxy.includes('allorigins')) {
                                fetchUrl = proxy + encodeURIComponent(searchApiUrl);
                            } else {
                                fetchUrl = proxy + searchApiUrl;
                            }
                            
                            const response = await fetch(fetchUrl);
                            if (response.ok) {
                                data = await response.json();
                                break; 
                            }
                        } catch(e) {
                            console.warn(`Search Proxy failed: ${proxy}`);
                        }
                    }

                    if (!data) {
                         throw new Error('APP_SEARCH_NETWORK_FAILED');
                    }
                    
                    if (data && data.items && data.items.length > 0) {
                        const appId = data.items[0].id;
                        const detectedName = data.items[0].name;

                        appIdInput.value = appId; 
                        gameNameInput.value = detectedName; 

                        await typeWriter(`> Success: Found AppID: ${appId} for "${detectedName}".`, 'terminal-msg', 500);
                        showToast(`تم العثور على AppID: ${appId}. جاري توليد الروابط...`, 'success', 3000);

                        generateManifest(true); 

                    } else {
                        throw new Error('APP_NOT_FOUND');
                    }

                } catch (error) {
                    
                    if (error.message === 'APP_NOT_FOUND') {
                         await typeWriter('> Error: Game not found. Try a more precise name or use the AppID directly.', 'terminal-error', 500);
                         showToast('خطأ: لم يتم العثور على لعبة بهذا الاسم. جرب اسماً أدق.', 'error');
                    } else if (error.message === 'APP_SEARCH_NETWORK_FAILED') {
                         await typeWriter(`> Critical Error: All Proxy servers failed to reach Steam Search API.`, 'terminal-error', 500);
                         showToast('خطأ حرج: جميع خوادم Proxy فشلت في البحث بالاسم.', 'error');
                    } else {
                         await typeWriter(`> Unknown Error: ${error.message}`, 'terminal-error', 500);
                         showToast('خطأ غير معروف أثناء البحث بالاسم.', 'error');
                    }
                } finally {
                    generateBtn.innerHTML = '<i class="fas fa-bolt"></i> توليد روابط التحميل والبحث عن المعلومات';
                    generateBtn.disabled = false;
                }
            }
            
            async function generateManifest(isAppId = false) {
                const inputValue = appIdInput.value.trim();
                
                if (!inputValue) {
                    showToast('الرجاء إدخال AppID أو اسم اللعبة.', 'error');
                    typeWriter('> Error: Input field is empty.', 'terminal-error');
                    return;
                }

                const isNumeric = /^\d+$/.test(inputValue);

                if (!isAppId && !isNumeric) {
                    terminal.innerHTML = ''; 
                    return processInputAsName(inputValue);
                }

                const appId = inputValue;
                currentAppId = appId; 
                
                generateBtn.innerHTML = '<span class="loading"></span> جاري المعالجة...';
                generateBtn.disabled = true;
                onlineFixInputGroup.style.display = 'none'; 
                terminal.innerHTML = '';
                successCheckmark.style.display = 'none';
                downloadButtonsGroup.style.display = 'none';
                gameImageContainer.style.display = 'none';
                apiGameInfo.style.display = 'none';
                steamInfoBtn.style.display = 'none'; 
                steamInfoBtn.innerHTML = '<i class="fas fa-info-circle"></i> عرض معلومات Steam API';


                try {
                    await typeWriter(`> Starting processing for AppID: ${appId}...`, 'terminal-cmd');
                    
                    const gameData = await fetchGameData(appId);
                    
                    if (!gameData) {
                        throw new Error('API_FETCH_FAILED_NO_DATA');
                    }
                    
                    displayApiInfo(gameData);
                    
                    const imageUrl = gameData.header_image || `https://cdn.cloudflare.steamstatic.com/steam/apps/${appId}/header.jpg`;
                    gameImage.src = imageUrl;
                    gameImageContainer.style.display = 'flex'; 

                    saveAppID(appId, gameData.name);
                    
                    steamInfoBtn.style.display = 'block';

                    await typeWriter(`> Success: Found game "${gameData.name}".`, 'terminal-msg', 500);
                    
                    successCheckmark.style.display = 'block';
                    downloadButtonsGroup.style.display = 'flex';
                    
                    if (customLinksData[appId]) {
                        customLinkBtn.style.display = 'flex';
                        customLinkBtn.onclick = () => { window.open(customLinksData[appId], '_blank'); };
                        showToast('تم العثور على رابط مخصص لهذه اللعبة!', 'success');
                    } else {
                        customLinkBtn.style.display = 'none';
                        showToast('تم توليد الروابط بنجاح! الرجاء تجربة المصادر.', 'success');
                    }
                    
                    let downloadUrl_1 = `https://raw.githubusercontent.com/ABAID-CODER/crackworld-manifest/main/${appId}.zip`; 
                    const downloadUrl_2 = `https://codeload.github.com/SteamAutoCracks/ManifestHub/zip/refs/heads/${appId}`; 
                    const downloadUrl_3 = `https://pub-5b6d3b7c03fd4ac1afb5bd3017850e20.r2.dev/${appId}.zip`; 
                    
                    downloadBtn1.onclick = () => { window.open(downloadUrl_1, '_blank'); };
                    downloadBtn2.onclick = () => { window.open(downloadUrl_2, '_blank'); };
                    downloadBtn3.onclick = () => { window.open(downloadUrl_3, '_blank'); };
                    
                } catch (error) {
                    if (error.message.includes('API_FETCH_FAILED')) {
                         await typeWriter('> Warning: API data could not be retrieved due to connection failure (AppID is still valid). Proceeding with manifest generation only.', 'terminal-error', 500);
                         await typeWriter(`> Attempting manifest generation for AppID: ${appId}`, 'terminal-cmd', 300);

                         saveAppID(appId, gameNameInput.value.trim() || 'غير محدد'); 
                         successCheckmark.style.display = 'block';
                         downloadButtonsGroup.style.display = 'flex';

                         let downloadUrl_1 = `https://raw.githubusercontent.com/ABAID-CODER/crackworld-manifest/main/${appId}.zip`; 
                         const downloadUrl_2 = `https://codeload.github.com/SteamAutoCracks/ManifestHub/zip/refs/heads/${appId}`; 
                         const downloadUrl_3 = `https://pub-5b6d3b7c03fd4ac1afb5bd3017850e20.r2.dev/${appId}.zip`; 
                         
                         downloadBtn1.onclick = () => { window.open(downloadUrl_1, '_blank'); };
                         downloadBtn2.onclick = () => { window.open(downloadUrl_2, '_blank'); };
                         downloadBtn3.onclick = () => { window.open(downloadUrl_3, '_blank'); };
                         
                         showToast('تحذير: فشل الاتصال بخادم Steam API، تم توليد روابط المانيفست الأساسية.', 'warning');

                    } else {
                        await typeWriter('> Error: Invalid AppID or unknown connection failure.', 'terminal-error', 500);
                        await typeWriter('> Please verify the AppID and try again', 'terminal-error', 300);
                        showToast('خطأ: لم يتم العثور على اللعبة أو خطأ في الاتصال. تحقق من الإدخال.', 'error');
                        apiGameInfo.style.display = 'none'; 
                    }
                } finally {
                    generateBtn.innerHTML = '<i class="fas fa-bolt"></i> توليد روابط التحميل والبحث عن المعلومات';
                    generateBtn.disabled = false;
                }
            }
            
            function searchOnlineFix() {
                const gameName = gameNameInput.value.trim();
                if (!gameName) {
                    showToast('الرجاء إدخال اسم اللعبة أولاً.', 'error');
                    return;
                }
                const onlineFixUrlBase = 'https://online-fix.me/index.php?do=search&subaction=search&story=';
                const onlineFixUrl = `${onlineFixUrlBase}${encodeURIComponent(gameName)}`; 
                window.open(onlineFixUrl, '_blank');
                showToast(`تم البحث عن "${gameName}" في Online Fix.`, 'info');
                onlineFixInputGroup.style.display = 'none';
            }
            
            fixSearchBtn.addEventListener('click', searchOnlineFix);
            
            steamDBNameBtn.addEventListener('click', () => {
                if (!currentAppId) {
                    showToast('يجب إدخال AppID أولاً.', 'error');
                    return;
                }
                const steamDbUrl = `https://steamdb.info/app/${currentAppId}/`;
                window.open(steamDbUrl, '_blank');
                showToast('تم فتح صفحة SteamDB. يرجى نسخ اسم اللعبة ولصقه في المربع إذا كان الاسم التلقائي غير صحيح.', 'info', 7000);
            });

            onlineFixBtn.addEventListener('click', () => {
                if (!currentAppId || isNaN(currentAppId)) {
                    showToast('الرجاء إدخال AppID أولاً.', 'error');
                    return;
                }
                steamDBNameBtn.innerHTML = `<i class="fas fa-copy"></i> استخدم الاسم المُكتشف أو ابحث في SteamDB App ${currentAppId}`;
                onlineFixInputGroup.style.display = 'block';
                gameNameInput.focus(); 
                showToast('استخدم الاسم التلقائي أو زر SteamDB لتصحيح الاسم، ثم اضغط "بحث في Online Fix".', 'info', 7000);
            });

            gameNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') { searchOnlineFix(); }
            });

            generateBtn.addEventListener('click', generateManifest);
            
            appIdInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') { generateManifest(); }
            });
            
            displayHistory(); 

        });
		
    </script>
</body>
</html>
